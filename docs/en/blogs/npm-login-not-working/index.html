<!doctype html><html lang=en>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatbile content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=author content="Clavin June">
<meta http-equiv=content-security-policy content="default-src 'self' 'unsafe-inline' https:; object-src 'none'; style-src 'self' 'unsafe-inline' fonts.googleapis.com github.githubassets.com; font-src fonts.gstatic.com; script-src 'self' 'unsafe-inline' www.googletagmanager.com gist.github.com giscus.app; base-uri 'none'; img-src 'self' images.unsplash.com i.kym-cdn.com iq.opengenus.org;">
<meta name=google-site-verification content="n8iUJq2zr7wQ8eTS_ozpypgZQhfezUeUOXhOr3-INrE">
<meta name=monetization content="$ilp.uphold.com/RYNmdxrFrPJB">
<meta name=description content="how to fix NPM login not working">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="June Personal Web">
<meta property="og:title" content="NPM Login Not Working">
<meta property="og:description" content="how to fix NPM login not working">
<meta property="og:type" content="article">
<meta property="og:url" content="https://clavinjune.dev/en/blogs/npm-login-not-working/"><meta property="og:image" content="https://images.unsplash.com/photo-1543966888-7c1dc482a810?w=1920&q=50"><meta property="article:section" content="blogs">
<meta property="article:published_time" content="2021-11-18T13:18:24+07:00">
<meta property="article:modified_time" content="2021-11-18T13:18:24+07:00">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://images.unsplash.com/photo-1543966888-7c1dc482a810?w=1920&q=50">
<meta name=twitter:title content="NPM Login Not Working">
<meta name=twitter:description content="how to fix NPM login not working">
<title>June Personal Web - NPM Login Not Working</title>
<link rel=stylesheet href="/css/style.min.caf3859664f2f17538a5252c2da2fafd55c3c16af6cf7edc370e96f06f065494.css" integrity="sha256-yvOFlmTy8XU4pSUsLaL6/VXDwWr2z37cNw6W8G8GVJQ=">
<link rel=preconnect href=https://fonts.gstatic.com crossorigin>
<link rel=preload href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@400;700&family=Roboto:wght@300;400;700&display=swap" as=style onload="this.onload=null,this.rel='stylesheet'">
<noscript>
<link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@400;700&family=Roboto:wght@300;400;700&display=swap">
</noscript>
<link rel=preload href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap" as=style onload="this.onload=null,this.rel='stylesheet'">
<noscript>
<link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap">
</noscript>
<link rel=stylesheet href="/css/single.min.30e13f7ca685fcdd264df2050de1e131a1178eb9515aef4e0b4e712c9c2ed042.css" integrity="sha256-MOE/fKaF/N0mTfIFDeHhMaEXjrlRWu9OC05xLJwu0EI=">
</head>
<body><nav class=fg-bold>
<a id=skip-to-content href=#content>Skip to content</a>
<ul id=menu><li><a href=https://clavinjune.dev/en/>HOME</a></li><li><a class=active href=https://clavinjune.dev/en/blogs/>BLOG</a></li></ul>
</nav>
<main class=single>
<h1 class=title>NPM Login Not Working</h1>
<div class="metadata font-16">
<a class=category href=https://clavinjune.dev/en/categories/tech>tech</a>
<span class=middot>&#183;</span>
<span>Nov 18, 2021</span>
<span class=middot>&#183;</span>
<span>~4 min</span>
</div>
<div id=content>
<figure>
<img srcset="https://images.unsplash.com/photo-1543966888-7c1dc482a810?q=50&w=240 240w,https://images.unsplash.com/photo-1543966888-7c1dc482a810?q=50&w=300 300w,https://images.unsplash.com/photo-1543966888-7c1dc482a810?q=50&w=360 360w,https://images.unsplash.com/photo-1543966888-7c1dc482a810?q=50&w=480 480w,https://images.unsplash.com/photo-1543966888-7c1dc482a810?q=50&w=768 768w,https://images.unsplash.com/photo-1543966888-7c1dc482a810?q=50&w=800 800w,https://images.unsplash.com/photo-1543966888-7c1dc482a810?q=50&w=960 960w,https://images.unsplash.com/photo-1543966888-7c1dc482a810?q=50&w=1024 1024w,https://images.unsplash.com/photo-1543966888-7c1dc482a810?q=50&w=1080 1080w,https://images.unsplash.com/photo-1543966888-7c1dc482a810?q=50&w=1200 1200w,https://images.unsplash.com/photo-1543966888-7c1dc482a810?q=50&w=1366 1366w,https://images.unsplash.com/photo-1543966888-7c1dc482a810?q=50&w=1920 1920w" sizes="(max-width: 480px) 480px, 100vw" src="https://images.unsplash.com/photo-1543966888-7c1dc482a810?q=50&w=1920" alt="Photo by @pinjasaur on Unsplash" title="Photo by @pinjasaur on Unsplash" width=100% height=auto>
<figcaption class=font-16>Photo by <a class="link unsplash-ref" rel="noreferrer nofollow noopener" target=_blank href=https://unsplash.com/@pinjasaur>@pinjasaur</a> on Unsplash</figcaption>
</figure>
<h2 id=tldr>TL;DR</h2>
<p><a class=link rel="nofollow noreferrer noopener" href=#the-solution>This solution</a> works for <code>Node v16.13.0</code> and <code>NPM v8.1.3</code></p>
<h2 id=introduction>Introduction</h2>
<p>I don&rsquo;t always hate working using NPM unless it starts downloading tons of node_modules and giving not so verbose logs. Today, my colleague and I found an NPM login bug that&rsquo;s not so interesting and hard to debug. It takes me about an hour to find out what is the root cause.</p>
<p>In this article, I will write the solution just in case you meet the same issue.</p>
<h2 id=current-condition>Current Condition</h2>
<p>In my current company, we use <code>Nexus3</code> as our private repository for the NPM module. I also use <code>Node v12.22.4</code> and <code>NPM v8.1.3</code> for working on my local machine. To login into our Nexus repository, I use <code>.npmrc</code> with this format:</p>
<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>@myorg:registry=https://repo.myorg.com/repository/npm-private
always-auth=true
_auth={{ base64 of username:password redacted here }}
</code></pre></td></tr></table>
</div>
</div><p>And we&rsquo;re happy with it. No issue.</p>
<h2 id=the-issue>The Issue</h2>
<p>The issue comes when my colleague wants to try using <code>Node v16.13.0</code>. When the <code>npm i @myorg/utils</code> command is executed, it starts saying <code>401</code>.</p>
<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>npm ERR! code E401
npm ERR! Unable to authenticate, need: BASIC realm=<span style=color:#a31515>&#34;Sonatype Nexus Repository Manager&#34;</span>

npm ERR! A complete log of this run can be found in:
npm ERR!     /home/user/.npm/_logs/2021-11-18T06_37_02_136Z-debug.log
</code></pre></td></tr></table>
</div>
</div><h2 id=finding-a-solution>Finding a Solution</h2>
<p>I wonder if it&rsquo;s the <code>Nexus 3</code> is not compatible with the <code>Node v16</code> or what. So I tried to re-login to the Nexus repository.</p>
<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ npm login --registry=https://repo.myorg.com/repository/npm-private/ --scope=@myorg/
npm notice Log in on https://repo.myorg.com/repository/npm-private/
Username: {{ username }}
Password: 
Email: (this IS public) {{ email@myorg.com }}
Logged in as {{ username }} on https://repo.myorg.com/repository/npm-private/.
</code></pre></td></tr></table>
</div>
</div><p>Okay, now we&rsquo;re logged in. But as soon as I check using <code>npm whoami</code>, it said <code>401</code> again.</p>
<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ npm whoami --registry=https://repo.myorg.com/repository/npm-private/ 
npm ERR! code E401
npm ERR! Unable to authenticate, need: BASIC realm=<span style=color:#a31515>&#34;Sonatype Nexus Repository Manager&#34;</span>

npm ERR! A complete log of this run can be found in:
npm ERR!     /home/user/.npm/_logs/2021-11-18T06_49_38_788Z-debug.log
</code></pre></td></tr></table>
</div>
</div><p>Then I check my <code>.npmrc</code> file content, turns out Node v16 has a different format of <code>.npmrc</code>. Here is my current <code>.npmrc</code> file content:</p>
<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>//repo.myorg.com/repository/npm-private/:_authToken=NpmToken.{{ uuid redacted here }}
</code></pre></td></tr></table>
</div>
</div><p>What a strange format. It doesn&rsquo;t reflect the scope, also I am still confused with the <code>_authToken</code> format itself. Of course, as a good developer, we need a fast hand for searching every keyword on google for our bugs. And then, I found <a class=link rel="nofollow noreferrer noopener" target=_blank href=https://github.com/npm/cli/issues/3284#issuecomment-846057616>this comment</a> by <a class=link rel="nofollow noreferrer noopener" target=_blank href=https://github.com/apottere>@apottere</a>. So, I tried to rewrite my <code>.npmrc</code> file content manually. This is my current <code>.npmrc</code> file content:</p>
<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>//repo.myorg.com/repository/npm-private/:always-auth=true
//repo.myorg.com/repository/npm-private/:_auth={{ base64 of username:password redacted here }}
</code></pre></td></tr></table>
</div>
</div><p>Seems promising, so I tried again to execute <code>npm i @myorg/utils</code> again. And it failed.</p>
<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ npm install @myorg/utils
npm ERR! code E404
npm ERR! 404 Not Found - GET https://registry.npmjs.org/@myorg%2futils - Not found
npm ERR! 404 
npm ERR! 404  <span style=color:#a31515>&#39;@myorg/utils@^0.2.0&#39;</span> is not in this registry.
npm ERR! 404 You should bug the author to publish it (or use the name yourself!)
npm ERR! 404 
npm ERR! 404 Note that you can also install from a
npm ERR! 404 tarball, folder, http url, or git url.

npm ERR! A complete log of this run can be found in:
npm ERR!     /home/user/.npm/_logs/2021-11-18T07_04_32_033Z-debug.log
</code></pre></td></tr></table>
</div>
</div><p>Yep, not found. I thought it was because the scope isn&rsquo;t reflected in the <code>.npmrc</code> file.</p>
<h2 id=the-solution>The Solution</h2>
<p>So I tried using the old way, rewriting the content manually. This is my current and final <code>.npmrc</code> file content:</p>
<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>@myorg:registry=https://repo.myorg.com/repository/npm-private
//repo.myorg.com/repository/npm-private/:always-auth=true
//repo.myorg.com/repository/npm-private/:_auth={{ base64 of username:password redacted here }}
</code></pre></td></tr></table>
</div>
</div><p>Lastly, I tried again the <code>npm i @myorg/utils</code> command and it worked.</p>
<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ npm install @myorg/utils

added 1 package, and audited 2 packages in 2s

found 0 vulnerabilities
</code></pre></td></tr></table>
</div>
</div><h2 id=conclusion>Conclusion</h2>
<p>So, It was the <code>npm login</code> command all along. I still can&rsquo;t find the whole documentation about the new <code>.npmrc</code> format, I might miss the docs, or maybe there isn&rsquo;t one. If you have the same issue, I hope you find this article and can fix the issue.</p>
<p>Thank you for reading!</p>
</div>
<div class=separator>
<span>&#183;</span>
<span>&#183;</span>
<span>&#183;</span>
</div>
<h2 class=subtitle>Love This Content?</h2>
<div class="fg-light support-me">Kindly support me via <a rel="noreferrer noopener" target=_blank class="fg-bold bottom-red" href=https://www.blockchain.com/btc/address/17Afj6o7xm3ZxQ38adnvSFHSBKhHiCDiev>Bitcoin</a>, <a rel="noreferrer noopener" target=_blank class="fg-bold bottom-red" href=https://ko-fi.com/clavinjune>Ko-fi</a>, <a rel="noreferrer noopener" target=_blank class="fg-bold bottom-red" href=https://trakteer.id/clavinjune>Trakteer</a>, or just continue to read another content. Any kind of supports is greatly appreciated!</div>
<h2 class=subtitle>Drop Your Comment Below</h2>
<script defer src=https://giscus.app/client.js data-repo=ClavinJune/ClavinJune.github.io data-repo-id="MDEwOlJlcG9zaXRvcnkxNTUyMjU5NTU=" data-category=General data-category-id=DIC_kwDOCUCPY84B_g1a data-mapping=title data-reactions-enabled=1 data-emit-metadata=0 data-theme=light crossorigin=anonymous async></script>
</script>
</main>
<script type=text/javascript src=https://clavinjune.dev/js/ga.js defer></script>
<script defer src="https://www.googletagmanager.com/gtag/js?id=G-MTSJ0LHJ06"></script><footer>
Copyright &copy; 2021 &#183; Clavin June
</footer>
<script defer type=text/javascript src=https://clavinjune.dev/js/copy.js></script>
</body>
</html>