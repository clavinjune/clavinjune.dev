(()=>{(function(){"use strict";window.i18next=window.i18next||{t:function(o){return o}};let a=window.i18next.t.bind(window.i18next);function c(t,o){return document.currentScript.getAttribute("data-"+t)||o}let y=c("page-url",window.location.href.replace(/#.*$/,"")),h=c("add-urls",void 0),v=c("id","webmentions"),f=c("wordcount"),E=c("max-webmentions",30),w=c("prevent-spoofing")?"wm-source":"url",j=c("sort-by","published"),R=c("sort-dir","up"),C=c("comments-are-reactions"),I={"in-reply-to":a("replied"),"like-of":a("liked"),"repost-of":a("reposted"),"bookmark-of":a("bookmarked"),"mention-of":a("mentioned"),rsvp:a("RSVPed"),"follow-of":a("followed")},L={"in-reply-to":"\u{1F4AC}","like-of":"\u2764\uFE0F","repost-of":"\u{1F504}","bookmark-of":"\u2B50\uFE0F","mention-of":"\u{1F4AC}",rsvp:"\u{1F4C5}","follow-of":"\u{1F41C}"},g={yes:"\u2705",no:"\u274C",interested:"\u{1F4A1}",maybe:"\u{1F4AD}"};function p(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function $(t,o){let n=p(t.author?.name??t.url.split("/")[2]),e=I[t["wm-property"]]||a("reacted");!o&&t.content&&t.content.text&&(e+=": "+k(t));let r="";t.author&&t.author.photo&&(r=`<img src="${p(t.author.photo)}" loading="lazy" decoding="async" alt="${n}">`);let i="";return t.rsvp&&g[t.rsvp]&&(i=`<sub>${g[t.rsvp]}</sub>`),`<a target="_blank" class="fg-bold bottom-red reaction" rel="noreferrer noopener nofollow ugc" title="${n} ${e}" href="${t[w]}">${r} ${L[t["wm-property"]]||"\u{1F4A5}"} ${i}</a>`}function m(t){return t.substr(t.indexOf("//"))}function b(t){let o=[],n={};return t.forEach(function(e){let r=m(e.url);n[r]||(o.push(e),n[r]=!0)}),o}function k(t){let o=p(t.content.text);if(f){let n=o.replace(/\s+/g," ").split(" ",f+1);n.length>f&&(n[f-1]+="&hellip;",n=n.slice(0,f),o=n.join(" "))}return o}function S(t){let o=`<h2 class="subtitle">${a("Webmention")}</h2>`,n=t.map(e=>{let r=$(e,!0),i=p(e.url.split("/")[2]);e.author&&e.author.name&&(i=p(e.author.name));let d=`<a target="_blank" class="fg-bold bottom-red source" rel="noreferrer noopener nofollow ugc" href="${e[w]}">${i}</a>`,l="name",u=`(${a("mention")})`;e.name?(l="name",u=e.name):e.content&&e.content.text&&(l="text",u=k(e));let s=`<span class="${l}">${u}</span>`;return`<li>${r} ${d} ${s}</li>`}).join("");return`${o} <ul class="comments">${n}</ul>`}function T(t){let o=`<h2>${a("Reactions")}</h2>`,n=t.map(e=>$(e)).join("");return`${o} <ul class="reacts">${n}</ul>`}window.addEventListener("load",async function(){let t=document.getElementById(v);if(!t)return;let o=[m(y)];h&&h.split("|").forEach(function(s){o.push(m(s))});let n=`https://webmention.io/api/mentions.jf2?per-page=${E}&sort-by=${j}&sort-dir=${R}`;o.forEach(function(s){n+=`&target[]=${encodeURIComponent("https:"+s)}`});let e={};try{let s=await window.fetch(n);s.status>=200&&s.status<300?e=await s.json():(console.error("Could not parse response"),new Error(s.statusText))}catch(s){console.error("Request failed",s)}let r=[],i=[];C&&(r=i);let d={"in-reply-to":r,"like-of":i,"repost-of":i,"bookmark-of":i,"follow-of":i,"mention-of":r,rsvp:r};e.children.forEach(function(s){let x=d[s["wm-property"]];x&&x.push(s)});let l="";r.length>0&&r!==i&&(l=S(b(r)));let u="";i.length>0&&(u=T(b(i))),t.innerHTML=`${l}${u}`})})();})();
